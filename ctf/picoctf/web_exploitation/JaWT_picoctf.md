# Challenge "JaWT Scratchpad" Writeup

## Vulnerability: JWT Token Manipulation with Secret Key Brute-Forcing

### Where: JSON Web Token (JWT) authentication with a weak secret key

### Impact: This challenge demonstrates how brute-forcing a weak JWT secret key can allow unauthorized access by modifying the token payload.

**NOTE**: The challenge involves brute-forcing the JWT secret key to modify the token payload, granting us access to the admin area and revealing the flag.

## Steps to reproduce:

1. **Inspect the JWT Token**:
   - On visiting the challenge link, the page asks for a username. We enter a username like `"check"` and receive a textarea and a new cookie named `jwt`.
   - The `jwt` token uses the `HS256` algorithm (HMAC SHA-256) for signing. 

   Example token structure:

   ```
   <header>.<payload>.<signature>
   ```

   Here, the payload contains only the user information.

2. **Modify the Payload**:
   - To access the admin page, we need to modify the payload in the JWT to set the `"user"` value to `"admin"`.
   - However, modifying the payload changes the signature, making the token invalid unless we know the secret key.

3. **Brute-Force the Secret Key**:
   - The challenge hints at a reference to "John," indicating we might use **John the Ripper** for a dictionary attack on the JWTâ€™s secret key.
   - We use the `rockyou.txt` wordlist for this brute-force attack.

   - First, save the original JWT in a text file (`JW.txt`), then run John the Ripper:

     ```
     john ./JW.txt --wordlist=./rockyou.txt
     ```

   - John the Ripper reveals the secret key: `ilovepico`.

4. **Create a New JWT**:
   - Using a JWT debugger, we:
     - Modify the payload to set `"user": "admin"`.
     - Use the discovered secret key, `ilovepico`, to generate a new, valid JWT signature.

5. **Set the Modified JWT Cookie**:
   - Replace the `jwt` cookie value in the browser with our newly generated JWT.
   - Refresh the page to authenticate as `admin`.

6. **Retrieve the Flag**:
   - After reloading the page with the new JWT, the flag is displayed in the textarea:

   ```
   picoCTF{jawt_was_just_what_you_thought_9ed4519dee8140de7a186a5df5a08d6e}
   ```

## Conclusion:

By brute-forcing the JWT secret key, we were able to modify the token payload, authenticate as the admin user, and retrieve the flag, successfully completing the challenge.
